# 14장 전역 변수의 문제점

## 14.1 변수의 생명주기

### 14.1.1 지역변수의 생명주기

- 변수는 선언에 의해 생성되고 할당을 통해 값을 가짐
- 변수는 자신이 선언된 위치에서 생성되고 소멸됨
- 전역변수의 생명주기는 애플리케이션 생명주기와 동일
- 함수 내부에서 선언된 지역변수는 함수가 호출되면 생성되고 함수 종료 시 소멸

  ```javascript
  function foo() {
    var x = "local";
    console.log(x); //local
    return x;
  }

  foo();
  console.log(x); // Reference Error
  ```

- 변수 선언은 선언문이 어디에 있는 상관없이 가장 먼저 실행, 즉 런타임 이전 단계에서 자바스크립트 엔진에 의해 먼저 실행 -> 이것은 전역변수에 한정됨!
- 함수 내부에서 선언한 변수는 함수가 호출된 직후에 자바스크립트엔진에 의해 먼저 실행
- 지역변수의 생명주기는 함수의 생명주기와 일치
- 변수의 생명주기는 메모리 공간이 확보된 시점부터 메모리 공간이 해제되어 가용메모리 풀에 반환되는 시점까지
- 호이스팅은 스코프 단위로 동작
  - 전역변수 호이스팅은 전역 변수 선언이 전역 스코프 선두로 올려진 것처럼, 지역변수는 지역스코프의 선두로 올려진 것처럼 동작
  - 호이스팅: 변수 선언이 스코프의 선두로 끌어 올려진 것처럼 동작하는 자바스크립트 고유의 특징

### 14.1.2 전역 변수의 생명주기

- var 키워드로 선언한 전역변수의 생명주기는 전역 객체의 생명주기와 일치 -> 웹 페이지 닫을 때까지 유효

## 14.2 전역변수의 문제점

- 암묵적 결합
  - 모든 코드가 전역변수를 참조하고 변경할 수 있는 암묵적 결합이 허용
  - 변수의 유효범위가 커지므로 가독성이 나빠지고 상태가 의도치 않게 변경될 수 있는 위험성 커짐
- 긴 생명 주기
  - 전역변수는 생명주기가 길고 메모리 리소스도 오랜 기간 소비
  - var 키워드는 변수 중복 선언이 허용되어 의도치 않은 재할당이 이뤄지기도 함
  ```javascript
  var x = 1;
  var x = 200;
  console.log(x); //100
  ```
- 스코프 체인 상에서 중점에서 존재
  - 전역변수는 스코프 ㅔㅊ인 상에서 종점으로 존재
  - 즉, 전역변수의 검색속도가 가장 느림
- 네임스페이스 오염
  - 자바스크립트 가장 큰 문제점은 파일이 분리되어있어도 하나의 전역 스코프를 공유 -> 동일한 이름의 전역변수나 전역함수가 있을 경우 예상치 못한 결과를 도출할 가능성이 커짐

## 14.3 전역 변수의 사용을 억제하는 방법

- 지역변수를 사용 -> 변수 스코프는 좁을수록 좋음

### 14.3.1 즉시 실행 함수

- 모든 코드를 즉시 실행함수로 감싸면 모든 함수는 즉시 실행함수의 지역변수로 만들자!

  ```javascript
  (function () {
    var foo = 10;
  })();
  console.log(foo);
  ```

### 14.3.2 네임스페이스 객체

- 객체를 생성하고 전역변수처럼 사용하고 싶은 변수를 프로퍼티로 추가하는 방법
  ```javascript
  var MYAPP = {}; //전역 네임스페이스 객체
  MYAPP.name = "Lee";
  console.log(MYAPP.name); //Lee
  ```

### 14.3.3 모듈 패턴

- 모듈 패턴은 관련이 있는 변수와 함수를 모아 즉시 실행 함수로 감싸 하나의 모듈을 만듦
- 클로저 기반으로 동작하고 캡슐화 구현 가능
- cf) 캡슐화: 프로퍼티 (객체 상태), 메서드(객체 동작)를 하나로 묶어 특정 프로퍼티나 메서드를 은닉함
- 자바스크립트는 접근 제한자를 제공하지 않음

```javascript
var Counter = (function () {
  var num = 0; //private
  return {
    increase() {
      return ++num;
    },
    decrease() {
      return --num;
    },
  };
})();

console.log(Counter.num); //undefined
console.log(Counter.increase()); // 1
```

### 14.3.4 ES6 모듈

- ES6 모듈을 사용하면 더는 전역변수를 사용할 수 없음
- ES6 모듈은 파일 자체의 독자적인 모듈 스코프를 제공
- 모듈 내에서는 var 키워드로 선언한 변수는 더는 전역변수가 아니며 window객체의 프로퍼티도 아님
- script 태그에 type = "module" 추가
  ```html
  <script type="module" src="..."></script>
  ```
